<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Inventory & Sales App</title>

<!-- CSS -->
<style>
body{font-family:Arial;margin:0;background:#f4f6fb}
header{background:#1976d2;color:#fff;padding:15px;text-align:center}
nav{display:flex;gap:5px;padding:10px;background:#e3e9f4}
nav button{flex:1;padding:10px;border:none;border-radius:5px;background:#1976d2;color:#fff}
section{display:none;padding:15px}
input,select,button{width:100%;padding:10px;margin:5px 0}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:6px}
#qr-reader{width:100%}
</style>

<!-- LIBRARIES (CDN â€“ punojnÃ« nÃ« GitHub Pages) -->
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body>

<header>
<h2>Inventory & Sales App</h2>
</header>

<nav>
<button onclick="show('import')">Hyrje</button>
<button onclick="show('sale')">Shitje</button>
<button onclick="show('clients')">KlientÃ«</button>
<button onclick="show('inventory')">Stok</button>
</nav>

<section id="import">
<h3>Hyrje Malli</h3>
<input id="iQR" placeholder="QR / Kod">
<input id="iName" placeholder="Emri produktit">
<input id="iQty" type="number" placeholder="Sasia">
<button onclick="addProduct()">Ruaj</button>
<div id="qr-reader"></div>
</section>

<section id="sale">
<h3>Shitje</h3>
<select id="saleClient"></select>
<input id="sQR" placeholder="QR Produkti">
<input id="sQty" type="number" placeholder="Sasia">
<input id="sPrice" type="number" placeholder="Ã‡mimi">
<button onclick="addSale()">Shto</button>
<button onclick="finishSale()">PDF FaturÃ«</button>
</section>

<section id="clients">
<h3>Klient i Ri</h3>
<input id="cName" placeholder="Emri">
<input id="cNIPT" placeholder="NIPT">
<button onclick="addClient()">Ruaj</button>
</section>

<section id="inventory">
<h3>Inventory</h3>
<table id="inv"></table>
</section>

<script>
let data = JSON.parse(localStorage.getItem("data")) || {products:[],clients:[]}
let saleItems=[]

function save(){localStorage.setItem("data",JSON.stringify(data))}

function show(id){
document.querySelectorAll("section").forEach(s=>s.style.display="none")
document.getElementById(id).style.display="block"
if(id==="sale")loadClients()
if(id==="inventory")loadInventory()
}

function addProduct(){
let p=data.products.find(x=>x.qr===iQR.value)
if(p)p.qty+=+iQty.value
else data.products.push({qr:iQR.value,name:iName.value,qty:+iQty.value})
save();alert("OK")
}

function addClient(){
if(data.clients.find(c=>c.nipt===cNIPT.value))return alert("Ekziston")
data.clients.push({name:cName.value,nipt:cNIPT.value})
save();alert("OK")
}

function loadClients(){
saleClient.innerHTML=""
data.clients.forEach(c=>{
let o=document.createElement("option")
o.value=c.nipt;o.text=c.name
saleClient.appendChild(o)
})
}

function addSale(){
let p=data.products.find(x=>x.qr===sQR.value)
if(!p||p.qty<sQty.value)return alert("Gabim stok")
p.qty-=+sQty.value
saleItems.push({name:p.name,qty:+sQty.value,price:+sPrice.value})
save();alert("Shtuar")
}

function finishSale(){
const {jsPDF}=window.jspdf
let d=new jsPDF();let y=20,total=0
saleItems.forEach(i=>{
d.text(`${i.name} ${i.qty} x ${i.price}`,10,y)
total+=i.qty*i.price;y+=7
})
d.text("TOTAL: "+total+"â‚¬",10,y+10)
d.save("fature.pdf")
saleItems=[]
}

function loadInventory(){
inv.innerHTML="<tr><th>Code</th><th>Produkt</th><th>Sasi</th></tr>"
data.products.forEach(p=>{
inv.innerHTML+=`<tr><td>${p.qr}</td><td>${p.name}</td><td>${p.qty}</td></tr>`
})
}

/* QR */
const qr=new Html5Qrcode("qr-reader")
qr.start({facingMode:"environment"},{fps:10,qrbox:250},
txt => {

  // nÃ«se je te hyrja e mallit
  if(document.getElementById("import").style.display === "block"){
    iQR.value = txt;
  }

  // nÃ«se je te shitja
  if(document.getElementById("sale").style.display === "block"){
    sQR.value = txt;

    // ðŸ” gjej produktin automatikisht
    let p = data.products.find(x => x.qr === txt);
    if(p){
      sQty.placeholder = "Max: " + p.qty;
    } else {
      alert("Produkti nuk ekziston nÃ« stok");
    }
  }

})

show("import")
</script>

</body>
</html>